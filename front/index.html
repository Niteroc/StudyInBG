<!DOCTYPE HTML>
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css"
      integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">

<html lang="fr">
<head>
    <title>StudyInBG</title>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>
    <link rel="stylesheet" href="front/assets/css/main.css"/>
    <noscript>
        <link rel="stylesheet" href="front/assets/css/noscript.css"/>
    </noscript>
</head>
<body class="is-preload">
<script src="front/assets/js/jquery.min.js"></script>

<!-- Wrapper -->
<div id="wrapper">
    <!-- Header -->
    <header id="header">
        <div class="logo">
            <span class="logoant"><img src="front/images/ff-tu.png"></span>
        </div>
        <div class="content">
            <div class="inner">
                <h1>StudyInBG : Votre Compagnon Essentiel</h1>
                <p>
                    Plongez dans votre aventure Erasmus en Bulgarie !
                    <br><br>
                    Notre site est votre guide pour chaque étape de cette expérience unique. De la recherche de logement
                    aux activités incontournables, en passant par les astuces pour vos courses et les transports,
                    découvrez tout ce dont vous avez besoin pour vous sentir chez vous.
                    Les professionnels locaux peuvent partager leurs services via notre espace dédié.
                    <br><br>
                    Bienvenue dans cette nouvelle aventure !
                </p>
            </div>
        </div>
        <nav>
            <ul id="sectionList">
                <li><a data-rubriqueid=0 href="#Contact">Contact</a></li>
            </ul>
        </nav>
    </header>

    <!-- Main -->
    <div id="main">

        <!-- Contact -->
        <article id="Contact">
            <h2 class="major">Contact</h2>
            <form id="contactForm">
                <div class="fields">
                    <div class="field">
                        <label for="name">Nom</label>
                        <input type="text" name="name" id="name" required/>
                    </div>
                    <div class="field">
                        <label for="activity">Activité</label>
                        <select name="activity" id="activity" required onchange="checkOther(this);">
                            <option value="">Choisissez une activité</option>
                        </select>

                        <div id="otherActivity" style="display: none;">
                            <label for="otherActivityInput"><br>Précisez votre activité</label>
                            <input type="text" name="otherActivityInput" id="otherActivityInput"/>
                        </div>

                        <script>
                            function sortSelect(selectId) {
                                var selectElement = document.getElementById(selectId);
                                var options = selectElement.getElementsByTagName("option");
                                var arr = Array.from(options).slice(1); // Ignorer la première option (vide)
                                arr.sort(function (a, b) {
                                    return a.text.localeCompare(b.text);
                                });
                                for (var i = 0; i < arr.length; i++) {
                                    selectElement.add(arr[i], null);
                                }
                                var optionToMove = selectElement.querySelector("option[value='Autre']");
                                selectElement.appendChild(optionToMove);
                            }

                            function checkOther() {
                                var select = document.getElementById("activity");
                                var otherActivityInput = document.getElementById("otherActivityInput");
                                var otherActivityDiv = document.getElementById("otherActivity");

                                if (select.value === "Autre") {
                                    otherActivityDiv.style.display = "block";
                                    otherActivityInput.setAttribute("required", "required");
                                } else {
                                    otherActivityDiv.style.display = "none";
                                    otherActivityInput.removeAttribute("required");
                                }
                            }

                            window.onload = function () {
                                $.ajax({
                                    type: "GET",
                                    dataType: 'JSON',
                                    url: "index.php?api=rubriqueall",
                                    success: function (data_rubrique) {

                                        let activity = document.getElementById("activity");

                                        data_rubrique.forEach(rubrique => {
                                            let option = document.createElement("option");
                                            option.value = rubrique.nom;
                                            option.innerText = rubrique.nom;
                                            activity.appendChild(option);
                                        });

                                        let option = document.createElement("option");
                                        option.value = "Autre";
                                        option.innerText = "Autre";
                                        activity.appendChild(option);

                                        sortSelect("activity");
                                    }
                                });
                            };
                        </script>
                    </div>
                    <div class="field">
                        <label for="message">Message</label>
                        <textarea name="message" id="message" rows="4" required></textarea>
                    </div>
                    <div class="field">
                        <label for="price">Prix (entre 1 et 5) - facultatif</label>
                        <input style="color: black" type="number" name="price" id="price" min="1" max="5"/>
                    </div>
                    <div class="field">
                        <label for="address">Adresse</label>
                        <input type="text" name="address" id="address" required/>
                    </div>
                    <div class="field">
                        <label for="image">Image</label>
                        <input type="file" name="image" id="image" accept="image/*" required/>
                    </div>
                </div>
                <ul class="actions">
                    <li><input type="submit" value="Envoyer" class="primary"/></li>
                    <li><input type="reset" value="Effacer"/></li>
                </ul>
            </form>
            <p id="successMessage" style="display: none; color: #0bc90b; text-align: center">Votre message a été envoyé
                avec succès !</p>
        </article>

        <script>
            $("#contactForm").submit(function (event) {
                event.preventDefault(); // Empêcher l'envoi du formulaire par défaut

                // Récupérer les données du formulaire
                const formData = new FormData(this);

                $.ajax({
                    type: "POST",
                    url: "router.php?api=create",
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function () {
                        // Affichage du message de succès
                        document.getElementById("successMessage").style.display = "block";

                        setTimeout(function () {
                            //window.location.href = "";
                        }, 2000); // Délai en millisecondes (2 secondes)
                    },
                    error: function (error) {
                        console.error(error); // Gérez les erreurs si nécessaire
                    }
                });
            });
        </script>
    </div>

    <!-- Footer -->
    <footer id="footer">
        <p class="copyright">&copy; Tous droits réservés - 12/2023 - <a href="index.php?page=admin">Administration</a>
        </p>
    </footer>

</div>

<!-- BG -->
<div id="bg"></div>

<!-- Scripts -->
<script src="front/assets/js/browser.min.js"></script>
<script src="front/assets/js/breakpoints.min.js"></script>
<script src="front/assets/js/util.js"></script>
<script src="front/assets/js/main.js"></script>
<script src="front/index.js"></script>

</body>
</html>
